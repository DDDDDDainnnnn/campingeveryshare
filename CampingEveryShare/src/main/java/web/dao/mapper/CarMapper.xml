<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="web.dao.face.CarDao">
	
	<sql id="selectCar">
		SELECT car_no, user_id, car_name, car_number, car_size, location, area, area_detail, 
		pickup_time_start, pickup_time_end, car_pax, car_spax, car_beds, price, extra_price, 
		car_elec, car_water, car_table, car_sink, car_kitchen, car_temp, car_shower, car_toilet, car_pet, car_smoke, car_status, content, delete_status
		, (SELECT user_nick FROM usertb U WHERE U.user_id = C.user_id ) as hostnick
		FROM cartb C
	</sql>

	<select id="selectCntAll" resultType="int" parameterType="web.util.Paging">
		SELECT count(*) FROM cartb
		<where>
			AND car_status = 0
			AND delete_status = 0
		</where>
	</select>
	
	<select id="selectAll" parameterType="web.util.Paging" resultType="map">
		SELECT * FROM (
		SELECT rownum rnum, R.* FROM (
			<include refid="selectCar" />
			<where>
				<if test="search != null and !''.equals(search)">
					AND car_name LIKE '%' || (#{search }) || '%'
				</if>
				AND delete_status = 0
			</where>
			ORDER BY car_no DESC
		) R )
		<where>
			AND rnum BETWEEN #{startNo } AND #{endNo }
		</where>
	</select>
	
	<select id="selectByCarNo" parameterType="Car" resultType="Car">
		<include refid="selectCar" />
		<where>
			AND car_no = #{carNo }
		</where>
	</select>

   <insert id="insertCarWrite" parameterType="Car">
   <selectKey keyProperty="carNo" resultType="int" order="BEFORE">
      SELECT car_seq.nextval FROM dual
   </selectKey>
   INSERT INTO cartb(CAR_NO,USER_ID,CAR_NAME,CAR_NUMBER,CAR_SIZE,LOCATION,AREA,AREA_DETAIL,PICKUP_TIME_START,PICKUP_TIME_END,CAR_PAX,CAR_SPAX,CAR_BEDS,PRICE,EXTRA_PRICE,CAR_ELEC,CAR_WATER,CAR_TABLE,CAR_SINK,CAR_KITCHEN,CAR_TEMP,CAR_SHOWER,CAR_TOILET,CAR_PET,CAR_SMOKE,CAR_STATUS,CONTENT)
     VALUES(#{carNo}, #{userId}, #{carName}, #{carNumber}, #{carSize}, #{location}, #{area}, #{areaDetail}, #{pickupTimeStart}, #{pickupTimeEnd}, #{carPax}, #{carSpax}, #{carBeds}, #{price},#{extraPrice}, #{carElec}, #{carWater}, #{carTable}, #{carSink}, #{carKitchen}, #{carTemp}, #{carShower}, #{carToilet}, #{carPet}, #{carSmoke}, 0, #{content})
   </insert>
	
	<insert id="insertFile" parameterType="Boardfile">
		<selectKey order="BEFORE" resultType="int" keyProperty="fileNo">
			SELECT file_seq.nextval FROM dual
		</selectKey>
		INSERT INTO boardfiletb ( file_no, board_no, origin_name, stored_name,board_cate )
		VALUES ( #{fileNo}, #{boardNo}, #{originName}, #{storedName},1 )
	</insert>
</mapper>